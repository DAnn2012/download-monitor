!function(a){"use strict";var t={counts:0,completed:0,ajaxRequests:[],ajaxStarted:1,ajaxTimeout:null,ajax:ajaxurl,entries:0,requestsNumber:0,init:function(){a(document).on("click","button#dlm-upgrade-db",function(e){e.preventDefault(),t.completed=0;e={url:t.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"dlm_db_log_entries",nonce:dlm_upgrader.nonce},success:function(e){t.entries=e,t.processAjax(),s.init()}};a.ajax(e)})},processAjax:function(){0<t.entries&&(t.requestsNumber=parseInt(Math.ceil(t.entries/1e4)));for(let e=0;e<=t.requestsNumber;e++){var a={url:t.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"dlm_upgrade_db",nonce:dlm_upgrader.nonce,offset:t.counts},success:function(){t.ajaxStarted=t.ajaxStarted-1,t.completed=t.completed+1,s.progressHandler(100*t.completed/t.requestsNumber)}};t.counts+=1,t.ajaxRequests.push(a)}var e={url:t.ajax,type:"post",async:!0,cache:!1,dataType:"json",data:{action:"dlm_alter_download_log",nonce:dlm_upgrader.nonce},success:function(){t.ajaxStarted=t.ajaxStarted-1,t.completed=t.completed+1,s.progressHandler(100*t.completed/t.requestsNumber)}};t.counts+=1,t.ajaxRequests.push(e),t.runAjaxs()},runAjaxs:function(){for(var e;t.ajaxStarted<2&&0<t.ajaxRequests.length;)t.ajaxStarted=t.ajaxStarted+1,e=t.ajaxRequests.shift(),a.ajax(e);0<t.ajaxRequests.length&&(t.ajaxTimeout=setTimeout(function(){console.log("Delayed 1s"),t.runAjaxs()},1e3))}};const s={el:{},label:{},init:()=>{s.el=jQuery("#dlm_progress-bar"),s.label=jQuery("#dlm_progress-bar .dlm-progress-label"),s.el.progressbar({value:0,change:()=>{s.label.text(s.el.progressbar("value")+"%")},complete:()=>{setTimeout(function(){s.label.text("Complete!"),s.el.addClass("completed")},3e3)}})},progressHandler:e=>{s.el.progressbar("value",e.toFixed(2))}};a(document).ready(function(){t.init()})}(jQuery);