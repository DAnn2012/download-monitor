jQuery(function(a){function o(){jQuery(".downloadable_files .downloadable_file").each(function(e,l){jQuery(".file_menu_order",l).val(parseInt(jQuery(l).index(".downloadable_files .downloadable_file")))})}var n;jQuery(".expand_all").click(function(){return jQuery(this).closest(".dlm-metaboxes-wrapper").find(".dlm-metabox table").show(),!1}),jQuery(".close_all").click(function(){return jQuery(this).closest(".dlm-metaboxes-wrapper").find(".dlm-metabox table").hide(),!1}),jQuery(".dlm-metaboxes-wrapper").on("click",".dlm-metabox h3",function(e){jQuery(e.target).filter(":input, option").length||jQuery(this).next(".dlm-metabox-content").toggle()}),jQuery(".dlm-metabox.closed").each(function(){jQuery(this).find(".dlm-metabox-content").hide()}),jQuery(".date-picker-field").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0}),jQuery(".downloadable_files").sortable({items:".downloadable_file",cursor:"move",axis:"y",handle:"h3",scrollSensitivity:40,forcePlaceholderSize:!0,helper:"clone",opacity:.65,placeholder:"dlm-metabox-sortable-placeholder",start:function(e,l){l.item.css("background-color","#f6f6f6")},stop:function(e,l){l.item.removeAttr("style"),o()}}),jQuery(".download_monitor_files").on("click","a.add_file",function(){jQuery(".download_monitor_files").block({message:null,overlayCSS:{background:"#fff url("+a("#dlm-plugin-url").val()+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}});var e=jQuery(".downloadable_files .downloadable_file").length,e={action:"download_monitor_add_file",post_id:a("#dlm-post-id").val(),size:e,security:a("#dlm-ajax-nonce-add-file").val()};return jQuery.post(ajaxurl,e,function(e){jQuery(".downloadable_files").prepend(e),o(),jQuery(".download_monitor_files").unblock(),jQuery(".date-picker-field").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:!0})}),!1}),jQuery(".download_monitor_files").on("click","button.remove_file",function(e){var l;return e.preventDefault(),confirm(dlm_ed_strings.confirm_delete)&&(0<(e=(l=jQuery(this).closest(".downloadable_file")).attr("data-file"))?(jQuery(l).block({message:null,overlayCSS:{background:"#fff url("+a("#dlm-plugin-url").val()+"/assets/images/ajax-loader.gif) no-repeat center",opacity:.6}}),e={action:"download_monitor_remove_file",file_id:e,download_id:a("#dlm-post-id").val(),security:a("#dlm-ajax-nonce-remove-file").val()},jQuery.post(ajaxurl,e,function(e){jQuery(l).fadeOut("300").remove()})):jQuery(l).fadeOut("300").remove()),!1}),jQuery(".download_monitor_files").on("click","a.dlm_browse_for_file",function(e){return downloadable_files_field=jQuery(this).closest(".downloadable_file").find('textarea[name^="downloadable_file_urls"]'),window.send_to_editor=window.send_to_browse_file_url,tb_show(dlm_ed_strings.browse_file,"media-upload.php?post_id="+a("#dlm-post-id").val()+"&amp;type=downloadable_file_browser&amp;from=wpdlm01&amp;TB_iframe=true"),!1}),window.send_to_browse_file_url=function(e){e&&(old=jQuery.trim(jQuery(downloadable_files_field).val()),old&&(old+="\n"),jQuery(downloadable_files_field).val(old+e)),tb_remove(),window.send_to_editor=window.send_to_editor_default},jQuery(document).on("click",".dlm_media_library",function(e){var l=a(this),o=l.parent().parent().find(".downloadable_file_urls"),t=o.val();e.preventDefault(),n&&n.close();e=[new wp.media.controller.Library({library:wp.media.query(),multiple:!0,title:l.data("choose"),priority:20,filterable:"all"})];(n=wp.media.frames.downloadable_file=wp.media({title:l.data("choose"),library:{type:""},button:{text:l.data("update")},multiple:!0,states:e})).on("select",function(){n.state().get("selection").map(function(e){(e=e.toJSON()).url&&(t=t?t+"\n"+e.url:e.url)}),o.val(t)}),n.on("ready",function(){n.uploader.options.uploader.params={type:"dlm_download"}}),n.open()}),a(".copy-dlm-button").click(function(e){e.preventDefault();e=a(this).parent().find("input");e.focus(),e.select(),document.execCommand("copy"),a(this).next("span").text(a(this).data("item")+" copied"),a(".copy-dlm-button").not(a(this)).parent().find("span").text("")}),a(".dlm_upload_file").click(function(e){var l;e.preventDefault(),button_elem=this,l=t,(e=document.createElement("input")).type="file",e.addEventListener("change",l),e.dispatchEvent(new MouseEvent("click"))});var t=function(e){[...this.files].forEach(e=>{var l=new FormData;l.append("file",e,e.name),l.append("action","dlm_upload_file"),a.ajax({type:"POST",url:dlm_ajaxurl.ajax_url,success:function(e){var l=a(button_elem).parent().parent().find(".downloadable_file_urls"),o=(o=l.val())?o+"\n"+e.data.file_url:e.data.file_url;l.val(o)},error:function(e){a(button_elem).parent().parent().find(".downloadable_file_urls").parent().append('<div class="notice notice-error"><p>'+e.data.errorMessage+"</p></div>")},async:!0,data:l,cache:!1,contentType:!1,processData:!1,timeout:6e4})})}});