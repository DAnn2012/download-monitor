jQuery(function(o){let n=[],d={};var e=Backbone.Model.extend({initialize:function(e){this.uploaderOptions=e;var e=this,t=new wp.Uploader(e.uploaderOptions),o=t.dropzone;o.on("dropzone:enter",e.show),o.on("dropzone:leave",e.hide),t.uploader.bind("FilesAdded",e.dlmFileAdded),t.uploader.bind("FileUploaded",e.dlmAddFileToPath),t.uploader.bind("Error",e.dlmUploadError)},show:function(){var e=o("#dlm-uploader-container").show();_.defer(function(){e.css({opacity:1})})},hide:function(){var e=o("#dlm-uploader-container").css({opacity:0});wp.media.transition(e).done(function(){"0"===e.css("opacity")&&e.hide()}),_.delay(function(){"0"===e.css("opacity")&&e.is(":visible")&&e.hide()},500)},dlmAddFileToPath:function(e,t){t=t.attachment.attributes.url;const o=jQuery(e.settings.browse_button).parents("td").find("textarea");o.parent().removeClass("dlm-blury");let n=o.val();n=n?n+"\n"+t:t,o.val(n)},dlmFileAdded:function(e,t){const o=jQuery(e.settings.browse_button).parents("td").find("textarea");o.parent().addClass("dlm-blury")},dlmUploadError:function(e,t){jQuery(e.settings.browse_button).parent().append('<p class="error description" style="color:red;">'+t.message+"</p>"),setTimeout(function(){jQuery(e.settings.browse_button).parent().find(".error.description").remove()},3500)}});d.uploadHandler=e,o(".dlm_upload_file").each((e,t)=>{n.push(o(t));t={browser:o(t),plupload:{multi_selection:!1},params:{type:"dlm_download"},container:o(t).parents("table.dlm-metabox-content"),dropzone:o(t).parents("table.dlm-metabox-content")};new d.uploadHandler(t)}),o(document).on("dlm_new_file_added",()=>{o(".dlm_upload_file").each((e,t)=>{if(n.includes(o(t)))return!0;n.push(o(t));t={browser:o(t),plupload:{multi_selection:!1},params:{type:"dlm_download"},container:o(t).parents("table.dlm-metabox-content"),dropzone:o(t).parents("table.dlm-metabox-content")};new wp.Uploader(t)})})});