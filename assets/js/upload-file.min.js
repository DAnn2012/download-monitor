jQuery(function(r){let o=[],a={};var e=Backbone.Model.extend({initialize:function(e){this.uploaderOptions=e;var e=this,t=new wp.Uploader(e.uploaderOptions),n=t.dropzone;n.on("dropzone:enter",e.show),n.on("dropzone:leave",e.hide),t.uploader.bind("FilesAdded",e.dlmFileAdded),t.uploader.bind("FileUploaded",e.dlmAddFileToPath),t.uploader.bind("Error",e.dlmUploadError)},dlmAddFileToPath:function(e,t){t=t.attachment.attributes.url;const n=jQuery(e.settings.browse_button).parents("td").find("textarea");n.parent().removeClass("dlm-blury");let i=n.val();i=i?i+"\n"+t:t,n.val(i)},dlmFileAdded:function(e,t){const n=jQuery(e.settings.browse_button).parents("td").find("textarea");n.parent().addClass("dlm-blury")},dlmUploadError:function(e,t){jQuery(e.settings.browse_button).parent().append('<p class="error description" style="color:red;">'+t.message+"</p>"),setTimeout(function(){jQuery(e.settings.browse_button).parent().find(".error.description").remove()},3500)}}),t=Backbone.View.extend({tagName:"div",className:"dlm-uploader-editor",template:wp.template("uploader-editor"),localDrag:!1,overContainer:!1,overDropzone:!1,draggingFile:null,args:{},elementContainer:null,initialize:function(e){return this.initialized=!1,this.args=e,this.elementContainer=jQuery(this.args.container[0]).attr("id"),window.tinyMCEPreInit&&window.tinyMCEPreInit.dragDropUpload&&this.browserSupport()&&(this.$document=r(document),this.dropzone=null,this.files=[],this.$document.on("drop","#"+this.elementContainer+" .dlm-uploader-editor",_.bind(this.drop,this)),this.$document.on("click","#"+this.elementContainer+" .dlm-uploader-editor",_.bind(this.click,this)),this.$document.on("dragover","#"+this.elementContainer+" .dlm-uploader-editor",_.bind(this.dropzoneDragover,this)),this.$document.on("dragleave","#"+this.elementContainer+" .dlm-uploader-editor",_.bind(this.dropzoneDragleave,this)),this.$document.on("dragover",_.bind(this.containerDragover,this)),this.$document.on("dragleave",_.bind(this.containerDragleave,this)),this.$document.on("dragstart dragend drop",_.bind(function(e){this.localDrag="dragstart"===e.type,"drop"===e.type&&this.containerDragleave()},this)),this.initialized=!0),this},browserSupport:function(){var e=document.createElement("div");return("draggable"in e||"ondragstart"in e&&"ondrop"in e)&&!!(window.File&&window.FileList&&window.FileReader)},isDraggingFile:function(e){return null!==this.draggingFile?this.draggingFile:!_.isUndefined(e.originalEvent)&&!_.isUndefined(e.originalEvent.dataTransfer)&&(this.draggingFile=-1<_.indexOf(e.originalEvent.dataTransfer.types,"Files")&&-1===_.indexOf(e.originalEvent.dataTransfer.types,"text/plain"),this.draggingFile)},refresh:function(e){return this.dropzone.toggle(this.overContainer||this.overDropzone),_.isUndefined(e)||r(e.target).closest(".dlm-uploader-editor").toggleClass("droppable",this.overDropzone),this.overContainer||this.overDropzone||(this.draggingFile=null),this},render:function(){return this.initialized&&(this.$el.html(this.template()),jQuery("#"+this.elementContainer).append(this.$el),this.dropzone=this.$el),this},containerDragover:function(e){!this.localDrag&&this.isDraggingFile(e)&&(this.overContainer=!0,this.refresh())},containerDragleave:function(){this.overContainer=!1,_.delay(_.bind(this.refresh,this),50)},dropzoneDragover:function(e){if(!this.localDrag&&this.isDraggingFile(e))return this.overDropzone=!0,this.refresh(e),!1},dropzoneDragleave:function(e){this.overDropzone=!1,_.delay(_.bind(this.refresh,this,e),50)},drop:function(e){return this.containerDragleave(e),this.dropzoneDragleave(e),!1},click:function(e){this.containerDragleave(e),this.dropzoneDragleave(e),this.localDrag=!1}});a.uploadHandlerModel=e,a.uploadHandlerView=t,r(".dlm_upload_file").each((e,t)=>{o.push(r(t));const n={browser:r(t),plupload:{multi_selection:!1},params:{type:"dlm_download"},container:r(t).parents("table.dlm-metabox-content"),dropzone:r(t).parents("table.dlm-metabox-content")},i=(new a.uploadHandlerModel(n),new a.uploadHandlerView(n));i.render()}),r(document).on("dlm_new_file_added",()=>{r(".dlm_upload_file").each((e,t)=>{if(o.includes(r(t)))return!0;o.push(r(t));const n={browser:r(t),plupload:{multi_selection:!1},params:{type:"dlm_download"},container:r(t).parents("table.dlm-metabox-content"),dropzone:r(t).parents("table.dlm-metabox-content")},i=(new a.uploadHandlerModel(n),new a.uploadHandlerView(n));i.render()})})});