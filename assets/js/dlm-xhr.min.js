function attachButtonEvent(){let o="",d="";jQuery.each(dlmXHR.xhr_links.class,function(e,t){o+=d+" ."+t,d=","}),jQuery("html, body").on("click",o,function(e){handleDownloadClick(this,e)})}function handleDownloadClick(e,t){t.stopPropagation();const o=e;let d={button:e,href:o.getAttribute("href"),buttonObj:jQuery(e)};if(-1!==d.href.indexOf("blob:http"))return d.buttonObj.addClass("download-100"),void setTimeout(function(){d.buttonObj.removeClass("download-100")},1500);"#"!==d.href?(t.preventDefault(),retrieveBlob(d)):console.log("No file path found")}function retrieveBlob(e){let{button:n,href:t,buttonObj:l}=e,r;const a=new XMLHttpRequest,i=l.attr("class");l.addClass("dlm-download-started"),n.setAttribute("href","#"),n.removeAttribute("download"),n.setAttribute("disabled","disabled"),t=0<t.indexOf("/?")?t+"&nonce="+dlmXHR.nonce:t+"?nonce="+dlmXHR.nonce,jQuery(document).trigger("dlm_download_triggered",[this,n,l,r]),a.responseType="blob",a.onreadystatechange=function(){var{status:e,readyState:t,statusText:o}=a,d=a.getAllResponseHeaders().split("\r\n").reduce((e,t)=>{var[o,t]=t.split(": ");return e[o]=t,e},{});if(void 0!==d["dlm-error"]&&""!==d["dlm-error"]&&null!==d["dlm-error"])return dlmLogDonwload(d["dlm-download-id"],d["dlm-version-id"],"failed",!1),void alert(d["dlm-error"]);if(void 0!==d["dlm-redirect"]&&""!==d["dlm-redirect"]&&null!==d["dlm-redirect"])return dlmLogDonwload(d["dlm-download-id"],d["dlm-version-id"],"redirected",!1),void(window.location.href=d["dlm-redirect"]);if(2==a.readyState&&a.status,404==e&&2==t){let e=document.createElement("p");e.innerHTML=o,n.parentNode.appendChild(e)}if(401==e&&2==t&&(window.location.href=o),403==e&&2==t){let e=document.createElement("p");e.innerHTML=o,n.parentNode.appendChild(e)}if(200==e&&4==t){t=a.response;let e=a.getResponseHeader("Content-Disposition").split("filename=")[1];e=e.replace(/\"/g,"").replace(";",""),r=URL.createObjectURL(t),n.removeEventListener("click",handleDownloadClick),n.setAttribute("href",r),n.setAttribute("download",""+e),n.click(),l.removeClass().addClass(i+" dlm-download-complete"),attachButtonEvent(),jQuery(document).trigger("dlm_download_complete",[this,n,l,r]),dlmLogDonwload(d["dlm-download-id"],d["dlm-version-id"],"completed",!1),setTimeout(function(){window.URL.revokeObjectURL(r)},6e4)}},a.addEventListener("progress",function(e){var t=e.loaded/e.total*100,t=Math.round(t);let o="download-"+10*Math.ceil(t/10);"100"!==t&&(o+=" dlm-download-started"),l.removeClass().addClass(i+" "+o),jQuery(document).trigger("dlm_download_progress",[this,n,l,r,e,t])}),a.onerror=function(){console.log("** An error occurred during the transaction")},a.open("GET",t,!0),a.setRequestHeader("dlm-xhr-request","dlm_XMLHttpRequest"),a.send()}function dlmLogDonwload(e,t,o,d){d={download_id:e,version_id:t,status:o,cookie:d,action:"log_dlm_xhr_download",nonce:dlmXHR.nonce};jQuery.post(dlmXHR.ajaxUrl,d,function(e){console.log("log created")})}attachButtonEvent();