let _OBJECT_URL;function handleDownloadLinkClick(e){var t=this.getAttribute("href");let o=this.parentNode.className.match(/[0-9]/g).join("");e.preventDefault();let r=new XMLHttpRequest,a=this;a.setAttribute("href","#"),a.removeAttribute("download"),a.setAttribute("disabled","disabled"),r.responseType="blob",r.onreadystatechange=function(){var{status:e,readyState:t,statusText:n}=r;if(404==e&&2==t){let e=document.createElement("p");e.innerHTML=n,a.parentNode.appendChild(e)}if(401==e&&2==t&&(window.location.href=n),403==e&&2==t){let e=document.createElement("p");e.innerHTML=n,a.parentNode.appendChild(e)}if(200==r.status&&4==r.readyState){n=r.response;_OBJECT_URL=URL.createObjectURL(n);n={action:"log_download",download_id:o};jQuery.post(dlmProgressVar.ajaxUrl,n,function(e){e=e.data;a.setAttribute("href",_OBJECT_URL),a.setAttribute("download",""+e),a.click()}),a.style.display="none",document.querySelector(`.download-container-${o} .spinner`).style.display="none";let e=document.createElement("p");e.innerHTML="Download complete <span>&#x2713;</span>",document.querySelector(".download-container-"+o).appendChild(e)}},r.addEventListener("progress",function(e){document.querySelector(`.download-container-${o} .spinner`).style.display="block"}),r.onerror=function(){console.log("** An error occurred during the transaction")},r.open("GET",t,!0),r.send(),this.removeEventListener("click",handleDownloadLinkClick)}function handleDownloadButtonClick(e){var t=this.getAttribute("href");let d=this.className.match(/[0-9]/g).join("");this.setAttribute("href","#"),this.removeAttribute("download"),this.setAttribute("disabled","disabled"),e.preventDefault();let l=this,i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="blob",i.onreadystatechange=function(){var e,t,n,{status:o,readyState:r,statusText:a}=i;if(404==o&&2==r){let e=document.createElement("p");e.innerHTML=a,l.parentNode.appendChild(e)}if(401==o&&2==r&&(window.location.href=a),403==o&&2==r){let e=document.createElement("p");e.innerHTML=a,l.parentNode.appendChild(e)}200==o&&4==r&&({status:e,readyState:t,statusText:n,response:r}=i,r=r,_OBJECT_URL=URL.createObjectURL(r),r={action:"log_download",download_id:d},jQuery.post(dlmProgressVar.ajaxUrl,r,function(e){e=e.data;l.setAttribute("href",_OBJECT_URL),l.setAttribute("download",e),l.click()}),setTimeout(()=>{document.querySelector(`.download-button-${d} .progress .progress-inner`).style.display="none";let e=document.createElement("span");e.classList.add("download-done"),l.children[0].appendChild(e)},1e3))},i.addEventListener("progress",function(e){e=e.loaded/e.total*100,e=Math.round(100*e)/100;document.querySelector(`.download-button-${d} .progress .progress-inner`).style.width=e+"%"}),i.onerror=function(){console.log("** An error occurred during the transaction")},i.send(),this.removeEventListener("click",handleDownloadButtonClick)}document.querySelectorAll(".download-link").forEach(function(e){e.addEventListener("click",handleDownloadLinkClick)},{once:!0}),document.querySelectorAll(".download-button").forEach(function(e){e.addEventListener("click",handleDownloadButtonClick)},{once:!0});