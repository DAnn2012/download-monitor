let _OBJECT_URL;function handleDownloadClick(e){var t=this.getAttribute("href");let n={button:this,href:t,hiddenInfo:jQuery('data.dlm-hidden-info[data-url="'+t+'"]'),buttonObj:jQuery(this)};if(0!==n.hiddenInfo.length&&"download"===n.hiddenInfo.data("action")){if(-1!==n.href.indexOf("blob:http"))return n.buttonObj.addClass("download-100"),void setTimeout(function(){n.buttonObj.removeClass("download-100")},1500);n.action=n.hiddenInfo.data("action"),n.id=n.hiddenInfo.data("id"),e.preventDefault();e={action:"dlm_check_permission",download_id:n.id,_nonce:dlmProgressVar.nonce};jQuery.post(dlmProgressVar.ajaxUrl,e,function(e){e.data.permission?(n.file_name=e.data.file_name,n.cookie_data=e.data.cookie_data,retrieveBlob(n)):alert("no permissions")})}}function retrieveBlob(e){const{button:o,href:t,hiddenInfo:d,buttonObj:r,id:a,file_name:i}=e,s=new XMLHttpRequest,l=r.attr("class");o.setAttribute("href","#"),o.removeAttribute("download"),o.setAttribute("disabled","disabled"),jQuery(document).trigger("dlm_download_triggered",[this,o,d,_OBJECT_URL]),s.responseType="blob",s.onreadystatechange=function(){var{status:e,readyState:t,statusText:n}=s;if(404==e&&2==t){let e=document.createElement("p");e.innerHTML=n,o.parentNode.appendChild(e)}if(401==e&&2==t&&(window.location.href=n),403==e&&2==t){let e=document.createElement("p");e.innerHTML=n,o.parentNode.appendChild(e)}200==s.status&&4==s.readyState&&(n=s.response,_OBJECT_URL=URL.createObjectURL(n),a,dlmProgressVar.nonce,o.removeEventListener("click",handleDownloadClick),o.setAttribute("href",_OBJECT_URL),d.attr("data-url",_OBJECT_URL),o.setAttribute("download",""+i),o.click(),setTimeout(function(){r.removeClass().addClass(l+" dlm-download-complete")},600),jQuery(document).trigger("dlm_download_downloaded",[this,o,d,_OBJECT_URL]),o.addEventListener("click",handleDownloadClick),d.find("span:not(.progress, .progress-inner)").remove(),d.find(".progress, .progress .progress-inner").removeClass("dlm-visible-spinner"),jQuery(document).trigger("dlm_download_complete",[this,o,d,_OBJECT_URL]))},s.addEventListener("progress",function(e){var t=e.loaded/e.total*100,t=Math.round(t),n="download-"+10*Math.ceil(t/10);d.css("visibility","visible"),r.removeClass().addClass(l+" "+n),d.find(".progress, .progress .progress-inner").addClass("dlm-visible-spinner"),jQuery(document).trigger("dlm_download_progress",[this,o,d,_OBJECT_URL,e,t])}),s.onerror=function(){console.log("** An error occurred during the transaction")},s.open("GET",t,!0),s.send()}document.querySelectorAll(".download-link,.download-button").forEach(function(e){e.addEventListener("click",handleDownloadClick)},{once:!0});