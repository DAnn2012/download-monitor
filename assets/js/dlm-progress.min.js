let _OBJECT_URL;function handleDownloadClick(e,t){t.stopPropagation();const n=e;var o=n.getAttribute("href");const r=jQuery('data.dlm-hidden-info[data-url="'+o+'"]');let d={button:e,href:o,hiddenInfo:r,buttonObj:jQuery(e),redirect:r.data("redirect")};if(0!==d.hiddenInfo.length&&"download"===d.hiddenInfo.data("action")){if(-1!==d.href.indexOf("blob:http"))return d.buttonObj.addClass("download-100"),void setTimeout(function(){d.buttonObj.removeClass("download-100")},1500);d.action=d.hiddenInfo.data("action"),d.id=d.hiddenInfo.data("id"),t.preventDefault();t={action:"dlm_check_permission",download_id:d.id,_nonce:dlmProgressVar.nonce};jQuery.post(dlmProgressVar.ajaxUrl,t,function(e){e.data.permission?(d.file_name=e.data.file_name,d.cookie_data=e.data.cookie_data,retrieveBlob(d)):e.data.no_access_url?window.location.href=e.data.no_access_url:d.buttonObj.after('<span class="dlm-permission-message"> - '+dlmProgressVar.no_permissions+"</span>")})}}let xhr_links="",$i="";function retrieveBlob(e){const{button:o,href:t,hiddenInfo:r,buttonObj:d,id:a,file_name:i}=e,s=new XMLHttpRequest,l=d.attr("class");o.setAttribute("href","#"),o.removeAttribute("download"),o.setAttribute("disabled","disabled"),jQuery(document).trigger("dlm_download_triggered",[this,o,r,_OBJECT_URL]),s.responseType="blob",s.onreadystatechange=function(){var{status:e,readyState:t,statusText:n}=s;if(404==e&&2==t){let e=document.createElement("p");e.innerHTML=n,o.parentNode.appendChild(e)}if(401==e&&2==t&&(window.location.href=n),403==e&&2==t){let e=document.createElement("p");e.innerHTML=n,o.parentNode.appendChild(e)}200==s.status&&4==s.readyState&&(n=s.response,_OBJECT_URL=URL.createObjectURL(n),a,dlmProgressVar.nonce,o.removeEventListener("click",handleDownloadClick),o.setAttribute("href",_OBJECT_URL),r.attr("data-url",_OBJECT_URL),o.setAttribute("download",""+i),o.click(),setTimeout(function(){d.removeClass().addClass(l+" dlm-download-complete")},600),jQuery(document).trigger("dlm_download_downloaded",[this,o,r,_OBJECT_URL]),o.addEventListener("click",handleDownloadClick),r.find("span:not(.progress, .progress-inner)").remove(),r.find(".progress, .progress .progress-inner").removeClass("dlm-visible-spinner"),jQuery(document).trigger("dlm_download_complete",[this,o,r,_OBJECT_URL]))},s.addEventListener("progress",function(e){var t=e.loaded/e.total*100,t=Math.round(t),n="download-"+10*Math.ceil(t/10);r.css("visibility","visible"),d.removeClass().addClass(l+" "+n),r.find(".progress, .progress .progress-inner").addClass("dlm-visible-spinner"),jQuery(document).trigger("dlm_download_progress",[this,o,r,_OBJECT_URL,e,t])}),s.onerror=function(){console.log("** An error occurred during the transaction")},s.open("GET",t,!0),s.send()}jQuery.each(dlmProgressVar.xhr_links.class,function(e,t){xhr_links+=$i+" ."+t,$i=","}),jQuery("html, body").one("click",xhr_links,function(e){handleDownloadClick(this,e)});